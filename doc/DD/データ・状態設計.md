## 3. データ設計（型・構造）

### 3.1 マス（Cell）データ構造

各マスは以下の情報を持つ。

```ts
type Cell = {
  x: number;              // 横位置（列）
  y: number;              // 縦位置（行）
  isMine: boolean;        // 地雷かどうか
  isOpen: boolean;        // 開かれているか
  isFlagged: boolean;     // 旗が立っているか
  adjacentMines: number; // 周囲の地雷数
};
```

**設計意図**

* マス単体で完結した情報を保持
* 座標を持たせることで処理を単純化
* 表示ロジックと判定ロジックの分離がしやすい

---

### 3.2 盤面（Board）データ構造

盤面はマスの集合として管理する。

```ts
type Board = {
  width: number;
  height: number;
  mineCount: number;
  cells: Cell[][]; // 2次元配列 [y][x]
};
```

**設計意図**

* 一般的なマインスイーパー構造
* 表示・ロジック双方で扱いやすい
* y, x の順にすることで行単位処理が容易

---

### 3.3 難易度定義

```ts
type DifficultyType = 'easy' | 'normal' | 'hard' | 'custom';

type DifficultySetting = {
  type: DifficultyType;
  width: number;
  height: number;
  mineCount: number;
};
```

**設計意図**

* 難易度を「値の集合」として扱える
* カスタム難易度も同一構造で処理可能
* UI とロジックで共通利用できる

---

### 3.4 ゲーム状態定義

```ts
type GameStatus = 'ready' | 'playing' | 'clear' | 'gameover';
```

**状態の意味**

* `ready`：ゲーム開始前（難易度選択直後）
* `playing`：プレイ中
* `clear`：クリア
* `gameover`：地雷を踏んだ状態

---

## 4. 状態設計（State設計）

### 4.1 管理する state 一覧

| state名         | 内容        |
| -------------- | --------- |
| board          | 現在の盤面情報   |
| gameStatus     | ゲームの進行状態  |
| difficulty     | 選択中の難易度設定 |
| remainingMines | 残り地雷数     |
| elapsedTime    | 経過時間（秒）   |

---

### 4.2 state の管理方針

* **最上位コンポーネント（例：App）で一元管理**
* 盤面操作はすべて親から関数として渡す
* 子コンポーネントは表示に専念

```text
App
 ├─ Header（残り地雷数・タイマー）
 ├─ GameBoard
 │   └─ Cell
 ├─ DifficultySelector
 └─ HighScoreDialog
```

---

### 4.3 各 state の詳細

#### board

```ts
const [board, setBoard] = useState<Board | null>(null);
```

* ゲーム開始時に初期化
* マスの開閉・旗操作で更新

---

#### gameStatus

```ts
const [gameStatus, setGameStatus] = useState<GameStatus>('ready');
```

**更新タイミング**

* ゲーム開始 → `playing`
* 地雷を踏む → `gameover`
* クリア条件達成 → `clear`

---

#### difficulty

```ts
const [difficulty, setDifficulty] =
  useState<DifficultySetting | null>(null);
```

* 難易度設定画面で更新
* ゲーム初期化の入力として使用

---

#### remainingMines

```ts
const [remainingMines, setRemainingMines] = useState<number>(0);
```

* 初期値：`mineCount`
* 旗の設置／解除で増減
* 表示専用の補助 state とする

---

#### elapsedTime

```ts
const [elapsedTime, setElapsedTime] = useState<number>(0);
```

* `playing` 状態でカウント開始
* `clear` / `gameover` で停止
* setInterval + useEffect で管理

---

### 4.4 state 間の関係

```text
difficulty
   ↓
board ──→ remainingMines
   ↓
gameStatus ──→ elapsedTime
```

**ポイント**

* board が中心
* 表示用 state（remainingMines, elapsedTime）は board / gameStatus に従属
