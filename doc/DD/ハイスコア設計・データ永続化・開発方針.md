## 7. ハイスコア設計・データ永続化・開発方針

---

### 7.1 ハイスコアの定義

#### ハイスコアの基準
- **最短クリア時間（秒）** をハイスコアとする
- クリア条件を満たした場合のみ記録対象とする

#### 対象難易度
- 初級
- 中級
- 上級

※ カスタム難易度はハイスコア対象外とする

#### 保存されるデータ数
- 難易度ごとに 1 件ずつ
- 合計 3 件のクリアタイムを保存

---

### 7.2 データ永続化設計

#### 永続化方式
- **LocalStorage** を使用する
- サーバー通信は行わない

---

#### 保存対象データ

- ハイスコア情報のみを保存対象とする

```ts
HighScoreData = {
  beginner: number | null
  intermediate: number | null
  advanced: number | null
}
````

* 未クリアの場合は `null` とする

---

#### 保存タイミング

* ゲームクリア時のみ保存処理を実行する
* 以下の条件を満たす場合に更新する：

  * 既存のハイスコアが存在しない
  * 今回のクリアタイムが既存の記録より短い

---

#### 読み込みタイミング

* アプリ起動時（App コンポーネント初期化時）
* ハイスコア表示画面を開いた際（必要に応じて）

---

#### LocalStorage キー設計例

```text
minesweeper_high_scores
```

---

### 7.3 エラーハンドリング・例外対応

#### 方針

* 学習目的のため、詳細なエラーログ出力は行わない
* エラー発生時は基本的に **処理を中断** する

---

#### 想定されるエラーと対応

| ケース                  | 対応           |
| -------------------- | ------------ |
| LocalStorage が利用できない | ハイスコア保存をスキップ |
| 保存データの形式不正           | 初期値で上書き      |
| 想定外の状態遷移             | 処理を中断        |
| 不正な操作（終了後のマス操作など）    | 何もしない        |

---

#### UI 表示

* エラーメッセージの表示は行わない
* ユーザー体験を阻害しないことを優先する

---

### 7.4 開発・実装方針

---

#### 7.4.1 デバッグモード

##### 目的

* 地雷配置・ロジック確認を容易にするため

##### 仕様

* 定数フラグでデバッグモードを制御する

```ts
const DEBUG_MODE = true
```

* デバッグモード ON の場合：

  * 地雷マスを視覚的に表示する
* 通常プレイ時には OFF とする

##### 方針

* 学習用途のため、実行環境による切り替えは行わない
* 実装は簡潔さを優先する

---

#### 7.4.2 ファイル・ディレクトリ構成案（CSS Modules 採用）

```
src/
├─ components/
│  ├─ Header/
│  │  ├─ Header.tsx
│  │  ├─ Header.module.css
│  │  ├─ MineCounter.tsx
│  │  ├─ MineCounter.module.css
│  │  ├─ Timer.tsx
│  │  ├─ Timer.module.css
│  │  ├─ RestartButton.tsx
│  │  └─ RestartButton.module.css
│  │
│  ├─ GameBoard/
│  │  ├─ GameBoard.tsx
│  │  ├─ GameBoard.module.css
│  │  ├─ Cell.tsx
│  │  └─ Cell.module.css
│  │
│  ├─ DifficultySelector/
│  │  ├─ DifficultySelector.tsx
│  │  └─ DifficultySelector.module.css
│  │
│  └─ HighScoreDialog/
│     ├─ HighScoreDialog.tsx
│     └─ HighScoreDialog.module.css
│
├─ logic/
│  ├─ gameInitializer.ts
│  ├─ mineGenerator.ts
│  ├─ openCell.ts
│  ├─ flagHandler.ts
│  └─ gameJudge.ts
│
├─ hooks/
│  └─ useTimer.ts
│
├─ types/
│  ├─ game.ts
│  └─ score.ts
│
├─ utils/
│  ├─ storage.ts
│  └─ debug.ts
│
├─ styles/
│  └─ global.css
│
├─ App.tsx
├─ App.module.css
└─ index.tsx
```

##### スタイル設計方針

* コンポーネント単位で CSS Modules を使用する
* クラス名の衝突を避けるため、グローバル CSS は最小限とする
* レイアウト・共通設定のみ `styles/global.css` に定義する

---

#### 7.4.3 利用技術

##### フロントエンド

* JavaScript
* TypeScript
* React

##### スタイリング

* **CSS Modules**

  * 各コンポーネント専用のスタイルファイルを作成
  * JSX 内では `styles.xxx` 形式で参照する

##### その他利用候補技術

* ESLint / Prettier（コード整形）
* React Hooks（useState / useEffect / custom hook）
* Vite または Create React App（開発環境）

---

### 7.5 設計上のポイント

* ハイスコアは最小限・明確な仕様に限定
* 永続化対象を絞り、実装を単純化
* デバッグ支援を入れつつ本番ロジックを壊さない
* CSS Modules により責務とスタイルの対応を明確化
* 学習しながら構造を理解しやすい設計を最優先する
