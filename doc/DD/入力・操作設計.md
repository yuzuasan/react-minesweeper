## 6. 入力・操作設計（マウス／タッチ）

---

### 6.1 設計方針

- PC（マウス）とスマートフォン（タッチ）で操作方法を分ける
- 操作内容は共通のアクション（マス開放／旗操作）に集約する
- 入力手段の違いを UI 層で吸収し、ゲームロジックは共通化する

---

### 6.2 操作とアクションの対応表

#### マウス操作（PC）

| 操作 | 対応アクション |
|----|----|
| 左クリック | マスを開く |
| 右クリック | 旗を立てる / 外す |

---

#### タッチ操作（スマートフォン）

| 操作 | 対応アクション |
|----|----|
| タップ | マスを開く |
| 長押し | 旗を立てる / 外す |

---

### 6.3 共通アクション定義

すべての入力操作は、最終的に以下のアクションに変換される。

- マスを開く  
  → `onOpenCell(x, y)`
- 旗を立てる / 外す  
  → `onToggleFlag(x, y)`

---

### 6.4 マス開放アクションの仕様

#### 実行条件
- 対象マスが未オープンであること
- 旗が立っていないこと
- ゲーム状態が `ready` または `playing` であること

#### 処理内容
- `ready` 状態の場合
  - タイマーを開始する
  - ゲーム状態を `playing` に変更する
- マス開放ロジックを実行する
- 地雷の場合はゲームオーバー処理を行う

---

### 6.5 旗操作アクションの仕様

#### 実行条件
- 対象マスが未オープンであること
- ゲーム状態が `ready` または `playing` であること

#### 制約
- 旗の設置数は地雷数を上限とする

#### 処理内容
- 旗が立っていない場合
  - 残り地雷数が 0 の場合は操作不可
- 旗が立っている場合
  - 無条件で解除可能
- 旗の ON / OFF を切り替える

---

### 6.6 マウス操作の詳細設計

#### 左クリック

- 対象：Cell コンポーネント
- イベント：`onClick`
- 処理：
  - `onOpenCell(x, y)` を呼び出す

---

#### 右クリック

- 対象：Cell コンポーネント
- イベント：`onContextMenu`
- 処理：
  - デフォルトのコンテキストメニューを抑止する
  - `onToggleFlag(x, y)` を呼び出す

---

### 6.7 タッチ操作の詳細設計

#### タップ

- 対象：Cell コンポーネント
- イベント：`onTouchEnd`
- 処理：
  - 長押し判定でない場合に `onOpenCell(x, y)` を呼び出す

---

#### 長押し

- 対象：Cell コンポーネント
- 判定方法：
  - `onTouchStart` 時にタイマーを開始
  - 一定時間（例：500ms）以上経過した場合に長押しと判定
- 処理：
  - `onToggleFlag(x, y)` を呼び出す
  - タップ操作はキャンセルする

---

### 6.8 ゲーム状態による操作制御

| ゲーム状態 | マス操作 |
|----------|--------|
| ready | 可能 |
| playing | 可能 |
| clear | 不可 |
| gameover | 不可 |

- `clear` / `gameover` 状態では、盤面操作を無効化する
- リスタート操作のみ受け付ける

---

### 6.9 UX 上の考慮点

- 長押し時間は誤操作を防ぐため短すぎない値とする
- 操作不可時は視覚的にわかるようにする（カーソル・スタイル）
- PC とスマートフォンで操作感が大きく変わらないことを重視する

---

### 6.10 設計上のポイント

- 入力方法とゲームロジックを分離することで実装を単純化
- 将来的な入力方式追加（キーボード等）にも対応しやすい
- 実際のマインスイーパーに近い操作感を再現できる
